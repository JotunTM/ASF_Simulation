%!TEX root = thesis.tex
\chapter{Methodology}
\label{c:methodology}
	


	This chapter describes the methodology used to find the optimum configurations of the ASF. An evaluation of the tools that were selected and how they are combined to create a modelling framework is given, and details of the simulation methodology are described.

	\section{Simulation Tool Selection}

		%In order to create an efficient simulation framework, various tools needed to be asessed. The general problem can be split up into

		To study the electricity generation and building energy consumption, a 3D geometry of the room and solar facade is built using the Rhinoceros software \cite{Rhino}, and its parametric modelling plugin Grasshopper \cite{grasshopper}. Rhinoceros is a state of the art computer-aided design (CAD) software, which can be used to generate complex geometries, such as the ASF. Combined with Grasshopper, which provides a visual programming language with a wide range of add-ons, it is particularly suited for simulations that are evaluating geometric structures. The simulation part can then be split up into three parts, namely \emph{building energy simulations}, \emph{radiation simulations} and \emph{photovoltaic simulations}. In the following the corresponding tools are described. 

		%The aquired data is then post-processed in Python \cite{python} to extract the configurations that minimise building energy consumption and maximise PV electricity production.

		
		\subsection{Building Energy Simulation}

			 %The building energy simulation is conducted using EnergyPlus \cite{energyplus} through the DIVA \cite{DIVA} interface.
			There are various building energy analysis engines, such as EnergyPlus \cite{energyplus} or TRNSYS \cite{trnsys}. As EnergyPlus is open source, widely used, and well documented, it was chosen as the building simulation engine for all simulations within this thesis. There are various ways of connecting to EnergyPlus. Within this thesis, mainly DIVA \cite{DIVA} and Honeybee\cite{roudsari2014ladybug} were evaluated. While Honeybee provides a large range of settings and adaptability, DIVA is kept very basic. However, the EnergyPlus analysis with honeybee is running significantly slower than with DIVA. Therefore, and for its simplicity, DIVA was chosen to connect Grasshopper with EnergyPlus. In EnergyPlus, the geometric solar facade is interpreted as an external shading system. Simulations are performed for a whole year at fixed angle positions, outputing hourly values of energy use for heating, cooling and lighting. Optimum positions can then be found by comparing the electricity deman during every hour for all combinations. 

		\subsection{Radiation Simulation} 

			A solar radiance simulation is run using Ladybug \cite{roudsari2014ladybug}, which is another grasshopper plugin and is developed by the same people as Honeybee. It includes various components to process weather data and calculate radiation on surfaces based on an automatically generated or a predefined mesh. Ladybug uses Radiance \cite{ward1994radiance} to determine the incident insolation on the solar facade. This approach enables the calculation of solar irradiance on the modules with high spatial resolution including the effect of module mutual shading as seen in Figure \ref{fig:radiation}. The radiation is analysed for cumulative monthly hours for the whole year. 
			\begin{figure}[H]
			\begin{center}
				\includegraphics[width=8cm, trim= 0cm 0cm 0cm 0cm,clip]{radiationanalysis.png}
				\caption{A simulation result showing module insolation from 11:00-12:00 on the 16 June for the used weather file and a specific module orientation.}
				\label{fig:radiation}
			\end{center}
			\end{figure}

		\subsection{Photovoltaic Simulation}
			%The  results are afterwards coupled to an electrical circuit simulation of thin-film PV modules with sub-cell level representation \cite{hofer2015PVSEC}. 
			The electrical model of the PV cells builds up on the methodology presented in \cite{hofer2015PVSEC} which is using the standard equivalent circuit model to calculate sub-cell I-V curves with a single diode, one series and one shunt resistance \cite{mermoud2010}. For the work in \cite{hofer2015PVSEC}, the PV simulation was implemented with MATLAB. For this work, the MATLAB code was adjusted to match the new radiation simulations and then translated to python, in which the rest of the framework is written (details in section \ref{s:simulationFramework}). PV electricity production is calculated based on a reference module. In addition to the irradiation dependency, the PV simulation includes temperature dependency. The temperature is estimated as suggested in \cite{Ross_Smokler_1986} with the following equation:

			\begin{equation}
				T_{cell} = T_{air} + \left(\frac{T_{cell}^0-T_{air}^0}{S^0}\right)S_{cell}
	      		\label{e:temp}
			\end{equation}

			where $T_{cell}$ is the temperature of each grid point on the module, $T_{air}$ is the ambient temperature, $T_{cell}^0$ is the temperature of the cell at reference insolation $S^0=800\frac{W}{m^2}$ and reference air temperature $T_{air}^0=20\degree C$, and $S_{cell}$ is the insolation of each gridpoint in $\frac{W}{m^2}$. The value of $T_{cell}^0$ was estimated using thermal images of the solar facade and typical values given in \cite{Ross_Smokler_1986}. 


	\section{Combined Evaluation}
		To combine the results of the building energy and the pv analysis, the building energy results were cumulatively combined to correspond to the pv analyis format. With this, the net energy useage of the room including the PV electricity production of the ASF can be given for monthly hours as described in equation \ref{e:minimize}. 

	\section{Simulation Framework}
	\label{s:simulationFramework}

		In general the approach needs to solve the following optimization problem:

		The following optimization problem has to be solved for PV modules as adaptive building shading systems:\\
		\begin{equation}
				minimize(C+H+L-PV)
		      	\label{e:minimize}
		\end{equation}

		Where $C$ is the electricity needed for cooling, $H$ is the electricty used for heating, $L$ is the lighting power demand and $PV$ represents the electricity production. Furthermore, different parameters must be evaluated to assess the effects of building orientation, possibilities and limits of current simulation tools, as well as various control strategy approaches.

		Building energy simulations are achieved by using DIVA, wheras a radiation analysis is done with LadyBug, both within Grasshopper for Rhino. The results are then fed into a python script, which calculates the electricity production based on the radiation results and the surrounding temperature and post processes the information to calculate energy demand and optimum configurations. A corresponding workflow can be seen in Figure \ref{fig:workflow}. 

		\begin{figure}[ht] %h can be omitted for better page layout
		\begin{center}
			\includegraphics[width=0.75\textwidth, trim= 0cm 0cm 0cm 0cm,clip]{workflow_vertical}
			\caption{Work flow of the simulation framework}
			\label{fig:workflow}
		\end{center} 
		\end{figure}

	\section{Case Study}
		%The case study is done for a room and facade representing the prototype of the ASF at the house of natural resources (HONR) \cite{honr}.  The solar facade consists of 400mm CIGS square panels that can rotate in two degrees of freedom. On the horizontal axis, the panels can move from 0$^{\circ}$ (closed) to 90$^{\circ}$ (open) position in steps of 22.5$^{\circ}$. In the vertical axis, it can move from 45$^{\circ}$ to -45$^{\circ}$ in 22.5$^{\circ}$ steps. Existing ASF systems \cite{nagy2015frontiers} have independently actuated panels and a continuous range of actuation, however for simplicity, we group all panels into one cluster that moves in unison. This leaves us with 25 possible dynamic configurations of the facade system.

		The case study is done for a room and facade representing the prototype of the ASF at the house of natural resources (HONR) \cite{nagy2015frontiers}.  The solar facade consists of 400mm CIGS square panels that can rotate in two degrees of freedom. On the horizontal axis, the panels can move from 0$^{\circ}$ (closed) to 90$^{\circ}$ (open), whereas in the vertical axis, they can move from 45$^{\circ}$ to -45$^{\circ}$. %Existing ASF systems \cite{nagy2015frontiers} have independently actuated panels and a continuous range of actuation, however for simplicity, we group all panels into one cluster that moves in unison. This leaves us with 25 possible dynamic configurations of the facade system. 

		The office environment is heated with a heatpump with an average COP of 4 and cooled with an average COP of 3. When required, the electric lighting consumption is 11.7 $W/m^2$. 

		%A simulation of each possible dynamic configuration of the facade is run for each hourly timestep of the year using using a weather file for Kloten, Switzerland. %\cite{genevaweatherfile}. %The results are then post-processed in Python \cite{python} to extract the configurations that minimise building energy consumption and maximise PV electricity production.

		Simulations are run for different angle combinations, with a weather file for Kloten, Switzerland. The base case for the simulations consists of 25 angle combinations (five azimuth and 5 altitude angles), evaluated for averaged days of every month. The base-case scenario is then compared to control strategies where the angles are fixed or follow sun tracking and the sensitivity of various parameters, such as building orientation and COP. A corresponding picture of the prototype installed ad the HONR, can be seen in figure \ref{fig:honr}. 

		\begin{figure}[ht] %h can be omitted for better page layout
			\begin{center}
			\includegraphics[width=0.75\textwidth, trim= 0cm 0cm 0cm 0cm,clip]{honr_small}
			\caption{Prototype of the adaptive solar facade on the house of natural resources}
			\label{fig:honr}
			\end{center} 
		\end{figure}



